version: '1.0'

steps:

  package_chart:
    title: package nomios chart
    image: codefresh/plugin-helm:2.8.1
    commands:
    - helm init --client-only
    - helm package -u nomios

  update_chart_repo:
    title: update nomios chart in repository
    image: codefresh/plugin-helm:2.8.1
    commands:
    - "VERSION=$(grep \"version: \" nomios/Chart.yaml | awk '{print $2}')"
    - PACKAGE=nomios-$VERSION.tgz
    - curl -X POST --user ${{BASIC_AUTH_USER}}:${{BASIC_AUTH_PASS}} --fail --data-binary "@$PACKAGE" ${{HELM_REPO_PATH}}
